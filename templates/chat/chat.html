{% extends "layout.html" %}

{% block content %}
<div class="chat_container my-4">
    <h3 style="color:black; border-bottom: 2px solid #ddd; padding-bottom: 10px;">Chat with {{r.username}}</h3>
    <div id="chatBox" class="chat-message border p-3">
        {% for message in messages %}
            {% if message.sender == request.user %}
                <div class="message-wrapper sender">
                    <div class="message sender-message">
                        <p>{{message.content}}</p>
                        <small class="timestamp">{{message.timeStamp|date:"H:i"}}</small>
                    </div>
                </div>
            {% else %}
                <div class="message-wrapper receiver">
                    <div class="message receiver-message">
                        <p>{{message.content}}</p>
                        <small class="timestamp">{{message.timeStamp|date:"H:i"}}</small> 
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>
    <form method = "POST" id = "messageForm" style = "position: sticky; bottom : 10px;">
        {% csrf_token %}
        <div>
            <input type="text" name = "msg" id = "messageInput", class = "form-control" placeholder = "Type your message">
            <button type = "submit", class = "btn btn-primary">Submit</button>
        </div>
    </form>
</div>

<style>
    .chat_container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        border-radius: 12px;
        background-color: #ffffff;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    #chatBox {
        height: 450px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 15px;
        background-color: #f0f2f5;
        border-radius: 8px;
    }

    /* Wrapper helps align the bubbles */
    .message-wrapper {
        display: flex;
        width: 100%;
    }

    .message-wrapper.sender {
        justify-content: flex-end;
    }

    .message-wrapper.receiver {
        justify-content: flex-start;
    }

    /* Base bubble styles */
    .message {
        max-width: 75%;
        padding: 10px 15px;
        border-radius: 18px;
        position: relative;
    }

    .message p {
        margin: 0;
        font-size: 1rem;
        line-height: 1.4;
    }

    .timestamp {
        font-size: 0.7rem;
        display: block;
        margin-top: 5px;
        opacity: 0.7;
    }

    /* Specific colors */
    .sender-message {
        background-color: #0084ff;
        color: white;
        border-bottom-right-radius: 2px;
    }

    .receiver-message {
        background-color: #e4e6eb;
        color: black;
        border-bottom-left-radius: 2px;
    }

    .sender-message .timestamp {
        text-align: right;
        color: #e0e0e0;
    }
</style>

<script>
    // Auto-scroll to bottom on load
    var chatBox = document.getElementById("chatBox");
    chatBox.scrollTop = chatBox.scrollHeight;
</script>
{% endblock %}